### **研发与发行方服务端对接指南**

#### **一、 背景说明**

这份文档是**游戏发行方**提供给**游戏研发方**的“对接手册”。

您可以这样理解双方的角色与这次合作：
*   **您（研发方）**：是游戏的**生产厂家**，负责开发好玩的游戏。
*   **我们（发行方）**：是游戏的**销售与运营平台**，我们拥有大量的玩家用户和支付渠道。

为了让您的游戏能安全地接入我们的平台，让我们的玩家能够顺利登录游戏并进行充值消费，我们需要建立一套标准的数据“通信协议”。这份文档就是这份协议的蓝图，它确保双方服务器能够安全、准确地进行数据交互。

#### **二、 核心接口摘要（需要做什么）**

整个对接过程，您最需要关注的就是以下两个核心接口，它们构成了玩家体验和商业变现的基础：

**1. 登录验证接口（玩家进入游戏的“验票通道”）**

*   **目的**：当玩家从我们（发行方）的平台启动您的游戏时，您的服务器需要验证这位玩家的身份是否合法有效，防止非法登录。
*   **流程**：
    1.  玩家从我们平台登录。
    2.  我们平台会引导玩家跳转到您的游戏，并携带一个“临时凭证”（token）和一些身份信息。
    3.  **您的游戏服务器需要向我们指定的地址发起一个查询请求**，问我们：“这个玩家和他的凭证是有效的吗？”
    4.  我们服务器会告诉您结果：“有效，这是他的真实ID” 或 “无效，请拒绝登录”。
*   **您的任务**：在您的游戏服务器端，实现一个向我们服务器 `https://xxx.com/cp/auth` 发起请求的客户端，并按照规则校验签名。

**2. 充值回调接口（玩家充值时，我们的“收款通知”）**

*   **目的**：当玩家在游戏内充值付款成功后，**我们的服务器会主动通知您的服务器**，告诉您：“有一位玩家付钱了，请给他发放对应的游戏币或商品”。
*   **流程**：
    1.  玩家在您游戏内发起充值。
    2.  调用我们的支付流程完成付款。
    3.  支付成功后，**我们的服务器会向您预先提供给我们的一个网址（您的服务器地址）发送发货请求**。
    4.  **您的服务器收到请求后，必须校验信息的真实性**，然后为玩家发货，并告诉我们“发货成功”。
*   **您的任务**：
    *   在您的服务器上提供一个能被我们访问到的URL地址（充值回调地址）。
    *   在该地址实现一个接口，用于接收我们的回调请求。
    *   **【极度重要】** 严格按照文档中的规则校验签名（`sign`），以防恶意用户伪造充值请求“刷单”。
    *   处理发货逻辑，并返回成功或失败的信息。

#### **三、 核心要点与安全提醒**

*   **安全是第一位**：两个接口都涉及**签名（sign）校验**，这是保障交易安全、防止数据篡改和刷单的核心机制，请务必严格按照文档给出的公式与顺序实现。
*   **幂等性处理**：对于充值回调，由于网络原因我们可能会重复发送请求，请确保您的接口能够识别已处理过的订单（根据`order_id`），**避免重复发货**。即使已经发过货，再次收到请求时也应返回成功。
*   **沟通确认**：在开始对接前，请务必从我们这里获取到关键的 `login_key`（用于登录）和 `pay_key`（用于充值），否则无法生成正确的签名。

---

总结来说，这份文档的核心就是 **“验明正身”**（登录校验）和 **“确认收款”**（充值回调）。抓住这两根主线，对接工作就会清晰很多。

#### **四、 详细对接文档**

[研发与发行方服务端对接指南](https://bj8ayj10zn.feishu.cn/wiki/DNrjwn5FAigX77kUSTKcPKAWnkc)