**游戏发行SDK前后端对接指南**

本文档旨在为游戏发行过程中的客户端与后端通信提供清晰、统一的技术对接框架。它适用于包括安卓、iOS、HTML5、微信小游戏、抖音小游戏及PC端在内的全平台游戏，涵盖了从用户登录、支付到数据上报等核心业务场景的标准化协议。通过规范数据格式、安全机制与交互流程，可显著提升开发效率与系统稳定性。

---

#### **一、 核心设计原则**
1.  **标准化**：所有请求与响应均采用JSON格式，统一编码为UTF-8。
2.  **安全性**：关键业务数据（尤其是移动端）通过AES+RSA进行双重加密传输，并设有签名机制防篡改。
3.  **可追溯性**：每个请求需携带唯一链路ID(`trace_id`)与请求ID(`request_id`)，便于问题定位与日志追踪。
4.  **平台兼容性**：通过客户端标识（如`app`, `wechat-mini-game`）和平台参数区分不同终端环境。

#### **二、 通信基础概述**
- **请求方式**：统一使用HTTP POST方法。
- **接口地址**：由主接入点、客户端类型和具体业务路径三部分组成。
- **通用参数**：每个请求需包含游戏ID(`game_id`)、渠道ID(`agent_id`)、设备信息、版本号及时间戳等基础信息。
- **返回结构**：所有接口返回统一的JSON格式：`{“code”: 状态码, “msg”: “提示信息”, “data”: {业务数据}}`。状态码“1”代表成功，其他均为异常。

#### **三、 主要业务模块说明**
**1. 初始化**
游戏启动后首先调用，用于获取系统基础配置，如客服联系方式、备用域名列表、当前可用的支付方式等。

**2. 用户账户体系**
*   **自营账号系统**：支持随机获取、注册、登录（含账号密码、短信验证码、Token三种方式）、密码找回与修改、手机绑定、实名认证及账户安全（登出/注销）等功能。
*   **联运渠道对接**：为第三方渠道（如应用商店）提供标准化的登录与支付接口。渠道方需传入其用户标识与认证信息，我方系统完成账户映射与处理。

**3. 支付流程**
*   **下单**：客户端提交支付方式、角色信息、商品信息及金额（单位：分）后，后端生成唯一订单并返回支付凭据（如订单号、支付链接或调起参数）。
*   **状态查询**：客户端可凭订单号主动查询支付最终结果（成功、取消、超时等）。
*   **支付方式**：支持微信支付、支付宝、抖音支付等多种方式，具体以初始化配置为准。

**4. 数据与事件上报**
*   **启动上报**：区分“首次激活”与“日常启动”，用于统计新增与活跃用户。
*   **游戏行为上报**：研发侧上报关键游戏内事件，如角色创建、进入游戏、等级提升等，用于数据分析。
*   **媒体回传**：将用户的注册、登录、付费等关键行为，按要求回传给相应的广告投放平台（如腾讯广告、巨量引擎等），用于广告效果归因与优化。

**5. 增值功能**
*   **礼包系统**：提供礼包列表查询与领取功能，状态实时更新。
*   **防沉迷**：该模块处于开发中，后续将集成实名认证与游戏时长/消费限额管控。

#### **四、 安全与加密机制（重点）**
为确保数据安全，特别是手游客户端的通信安全，采用以下机制：
1.  **业务数据加密**：所有POST业务参数会先被封装为JSON字符串，随后使用一个随机生成的32位AES密钥进行加密（ECB模式），最后进行Base64编码。
2.  **密钥安全传输**：上述AES密钥本身会通过RSA公钥进行加密，并同样进行Base64编码后传输。
3.  **签名验证**：每个请求需计算签名（`sign = MD5(时间戳 + 应用密钥)`），防止伪造。
4.  **解密流程**：后端收到请求后，先验证签名，再用RSA私钥解密出AES密钥，最后用该密钥解密业务数据。

#### **五、 附录摘要**
- **状态码**：`1`=成功；`100000`=系统内部错误；`200000`=登录态失效或Token无效。
- **签名算法**：见上述第四部分。
- **常见广告媒体**：包括腾讯广告、巨量引擎、快手磁力引擎、百度等。

#### **六、 项目地址**
[项目地址](https://github.com/cngamesdk/api)

#### **七、 详细对接文档**
[对接文档](https://bj8ayj10zn.feishu.cn/wiki/BgrswPgaGiCpb3kGyc4cJ0qvnRd)

---
**总结**：本规范是游戏发行SDK对接的技术基石，明确约定了通信方式、数据格式与核心业务流程。开发者在接入时，应重点关注**全局参数**的完整性、**安全加密**的正确实现以及**统一返回结构**的处理。遵循此文档将有效保障对接顺利进行与线上系统稳定。

--- 
#### **修订记录**

- 2025.12.04
  1. 「忘记密码」接口新增密码字段，直接由用户设置密码
